function saveNewCard(a){var b=document.getElementById("add"+a+"Form"),c=(serialize(b,"json"),document.getElementById("tagID").value);b.style.display="none",showPopUPMessage("lodaing",pageTexts.LOADINGMESSAGE,ulang.GLOBAL.BUTNS.CANCEL),getCloudData({dataSafeKey:"NOLCloudLists",success:function(a){var b={nolLists:[]};if("undefined"!=typeof a.dataSafeValue&&(b=JSON.parse(a.dataSafeValue)),b.nolLists.length>0)for(var d in b.nolLists){var e=b.nolLists[d];if(e.tagID==c)return showPopUPMessage("error",pageTexts.ADDCARD_EXT,ulang.GLOBAL.BUTNS.OK),!1}var f={language:"en-US",userID:"user",tagID:c};debug&&(f.debug=!0),postJSON({url:endPointBooking+"/nol/cardKey?_rnd="+(new Date).getTime(),postBody:JSON.stringify(f),success:function(a){var d={language:"en-US",userID:"user",cardKey:a.cardKey};debug&&(d.debug=!0),postJSON({url:endPointBooking+"/nol/balance?_rnd="+(new Date).getTime(),postBody:JSON.stringify(d),success:function(a){b.nolLists.push({tagID:c}),saveCloudData({dataSafeKey:"NOLCloudLists",dataSafeValue:JSON.stringify(b)});addNOLHtmlItem({balance:a.balance,Id:c});1==b.nolLists.length&&saveDefaultCardInCloud(c,function(a){updateDefaultCardInGui(a)}),showPopUPMessage("error",pageTexts.ADDCARD_SUCCES,ulang.GLOBAL.BUTNS.OK)},error:function(){showPopUPMessage("error",pageTexts.ADDCARD_ERROR,ulang.GLOBAL.BUTNS.OK)}})},error:function(a){JSON.parse(a.responseText);showPopUPMessage("error",pageTexts.ADDCARD_ERROR,ulang.GLOBAL.BUTNS.OK)}})}})}function removeCloudCard(a){showPopUPMessage("",pageTexts.DELCARD_CONF_NOL,ulang.GLOBAL.BUTNS.YES,function(){var b=a;getCloudData({dataSafeKey:"NOLCloudLists",success:function(c){for(var d=JSON.parse(c.dataSafeValue),e=0;e<d.nolLists.length;e++)d.nolLists[e].tagID==b&&d.nolLists.splice(e,1);saveCloudData({dataSafeKey:"NOLCloudLists",dataSafeValue:JSON.stringify(d),success:function(b){var c=document.getElementById(a);c.parentNode.removeChild(c),0==d.nolLists.length&&(nolCardLists.innerHTML="<div class='noBookingsMessage'>"+pageTexts.NoNolCard+"</div>");var e=null;getCloudData({dataSafeKey:"NOLCardSelected",success:function(b){"undefined"!=typeof b.dataSafeValue&&(e=JSON.parse(b.dataSafeValue)),null!=e&&e.tagID==a&&(0==d.nolLists.length?saveDefaultCardInCloud("",null):saveDefaultCardInCloud(d.nolLists[0].tagID,function(a){updateDefaultCardInGui(a)}))},error:function(){}})},error:function(){alert("error saveCloudData")}})},error:function(){alert("error getCloudData")}})},ulang.GLOBAL.BUTNS.NO,function(){})}function saveDefaultCardInCloud(a,b){var c={tagID:a};saveCloudData({dataSafeKey:"NOLCardSelected",dataSafeValue:JSON.stringify(c),success:function(c){"function"==typeof b&&b(a)},error:function(){alert("default card could not be saved")}})}function setAsDefaultCard(a){saveDefaultCardInCloud(a,function(a){updateDefaultCardInGui(a)})}function updateDefaultCardInGui(a){var b=nolCardLists.querySelectorAll("li span.star-on");if(b.length>0)for(var c=0;c<b.length;c++)b[c].className="",b[c].className="star-off";var d=document.querySelectorAll("[data-nol-cardid='"+a+"']");if(d.length>0){var e=d[0];e.className="",e.className="star-on",nolCardLists.firstChild.id!=a&&nolCardLists.insertBefore(document.getElementById(a),nolCardLists.firstChild)}}function addNOLHtmlItem(a){var b=document.createElement("li");if(1==a.selectedDefault)var c="star-on";else var c="star-off";var d=a.Id.substr(0,3)+" "+a.Id.substr(3,3)+" "+a.Id.substr(6),e="<div class='swipeButton'><span data-nol-cardId='"+a.Id+"' class='"+c+"' onclick='setAsDefaultCard(\""+a.Id+"\");'></span><span data-content='cardBalance'>"+("ar"==lang?"<i> "+a.balance+" </i>"+ulang.GLOBAL.CURRENCY:ulang.GLOBAL.CURRENCY+"<i> "+a.balance+" </i>")+"</span><span data-content='nolCardTagId'>"+pageTexts.NolCardNumber+"<br> "+d+" </span><span onclick='removeCloudCard(\""+a.Id+"\");'></span></div><div class='cancelButton' onclick='removeCloudCard(this);'>"+ulang.GLOBAL.BUTNS.REMOVE+"</div>";return b.innerHTML=e,b.id=a.Id,b.className="swipeButtonWrapper",1==nolCardLists.childNodes.length&&"DIV"==nolCardLists.childNodes[0].nodeName.toUpperCase()&&(nolCardLists.innerHTML=""),1==a.selectedDefault&&nolCardLists.firstChild?nolCardLists.insertBefore(b,nolCardLists.firstChild):nolCardLists.appendChild(b),b}content.innerHTML=pageData.BODY,pageTexts=pageData;var nolCardLists=document.getElementById("nolCardList"),salikCardLists=document.getElementById("salikCardList"),addNolCard=document.querySelector('[data-target="addNolCard"]'),addSalikAccount=document.querySelector('[data-target="addSalikaccount"]'),SalikCard=function(){var a=function(){var a=document.getElementById("addSalikForm"),b={accountID:document.getElementById("accountID").value,accountPIN:document.getElementById("accountPIN").value};a.style.display="none",showPopUPMessage("lodaing",pageTexts.LOADINGMESSAGE,ulang.GLOBAL.BUTNS.CANCEL),getCloudData({dataSafeKey:"SalikCloudLists",success:function(a){var c={salikLists:[]};if("undefined"!=typeof a.dataSafeValue&&(c=JSON.parse(a.dataSafeValue),"undefined"==typeof c.salikLists&&(c.salikLists=[])),"undefined"!=typeof c.salikLists&&c.salikLists.length>0)for(var d in c.salikLists){var e=c.salikLists[d];if(e.accountID==b.accountID)return showPopUPMessage("error",pageTexts.ADDCARD_EXT,ulang.GLOBAL.BUTNS.OK),!1}var f={accountID:b.accountID,accountPIN:b.accountPIN};debug&&(f.debug=!0),postJSON({url:endPointBooking+"/salik/balance?_rnd="+(new Date).getTime(),postBody:JSON.stringify(f),success:function(a){c.salikLists.push(b),saveCloudData({dataSafeKey:"SalikCloudLists",dataSafeValue:JSON.stringify(c)}),b.balance=a.balance;SalikCard.renderCard(b);if(1==c.salikLists.length){var d=b.accountID+"/"+b.accountPIN;SalikCard.saveDefault(d,function(a){SalikCard.updateGui(a)})}showPopUPMessage("error",pageTexts.ADDCARD_SUCCES,ulang.GLOBAL.BUTNS.OK)},error:function(){showPopUPMessage("error",pageTexts.ADDCARD_ERROR,ulang.GLOBAL.BUTNS.OK)}})}})},b=function(a){var b=a.accountID+"/"+a.accountPIN,c=document.createElement("li");if(1==a.selectedDefault)var d="star-on";else var d="star-off";var e="<div class='swipeButton'><span data-cardId='"+b+"' class='"+d+"' onclick='SalikCard.setDefault(\""+b+"\");'></span><span data-content='cardBalance'>";return e+=""==a.balance?"<div class='invalidAccount'> "+pageTexts.SalikAccountInvalid+" </div>":"ar"==lang?"<i> "+a.balance+" </i>"+ulang.GLOBAL.CURRENCY:ulang.GLOBAL.CURRENCY+"<i> "+a.balance+" </i>",e+="</span><span data-content='salikCardTagId'>"+pageTexts.NolCardNumber+"<br> "+a.accountID+" </span><span onclick='SalikCard.delete(\""+b+"\");'></span></div><div class='cancelButton' onclick='SalikCard.delete(\""+b+"\");'>"+ulang.GLOBAL.BUTNS.REMOVE+"</div>",c.innerHTML=e,c.id=b,c.className="swipeButtonWrapper",1==salikCardLists.childNodes.length&&"DIV"==salikCardLists.childNodes[0].nodeName.toUpperCase()&&(salikCardLists.innerHTML=""),document.getElementById("addSalikAccount").style.display="none",document.getElementById("salikTopUpButton").style.display="",salikCardLists.appendChild(c),c},c=function(a,b){var c={accountID:a};saveCloudData({dataSafeKey:"SalikCardSelected",dataSafeValue:JSON.stringify(c),success:function(c){"function"==typeof b&&b(a)},error:function(){alert("default card could not be saved")}})},d=function(a){SalikCard.saveDefault(a,function(a){SalikCard.updateGui(a)})},e=function(a){var b=salikCardLists.querySelectorAll("li span.star-on");if(b.length>0)for(var c=0;c<b.length;c++)b[c].className="",b[c].className="star-off";var d=document.querySelectorAll("[data-cardid='"+a+"']");if(d.length>0){var e=d[0];e.className="",e.className="star-on"}},f=function(a){showPopUPMessage("",pageTexts.DELCARD_CONF_SALIK,ulang.GLOBAL.BUTNS.YES,function(){var b=a.split("/"),c=b[0];b[1];getCloudData({dataSafeKey:"SalikCloudLists",success:function(b){for(var d=JSON.parse(b.dataSafeValue),e=0;e<d.salikLists.length;e++)d.salikLists[e].accountID==c&&d.salikLists.splice(e,1);saveCloudData({dataSafeKey:"SalikCloudLists",dataSafeValue:JSON.stringify(d),success:function(b){var c=document.getElementById(a);c.parentNode.removeChild(c),document.getElementById("addSalikAccount").style.display="",salikCardLists.innerHTML="<div class='noBookingsMessage'>"+pageTexts.NoSalikAccount+"</div>",document.getElementById("salikTopUpButton").style.display="none";var e=null;getCloudData({dataSafeKey:"SalikCardSelected",success:function(b){if("undefined"!=typeof b.dataSafeValue&&(e=JSON.parse(b.dataSafeValue)),null!=e&&e.accountID==a)if(0==d.salikLists.length)SalikCard.saveDefault("",null);else{var c=d.salikLists[0].accountID+"/"+d.salikLists[0].accountPIN;SalikCard.saveDefault(c,function(a){SalikCard.updateGui(a)})}},error:function(){}})},error:function(){alert("error saveCloudData")}})},error:function(){alert("error getCloudData")}})},ulang.GLOBAL.BUTNS.NO,function(){})};return{saveCard:a,renderCard:b,setDefault:d,saveDefault:c,updateGui:e,"delete":f}}();addNolCard.onclick=function(){popup.open(),info.innerHTML='<div class="popup"><div class="popup-header"><span class="popup-title">'+pageTexts.AddNolCardFormTitle+'</span><span class="popup-close" onclick="popup.close();"></span></div><form id="addNOLForm"><div class="popup-content"><label>'+pageTexts.AddNolCardInputlabel+'</label><input type="tel" maxlength="10" id="tagID" name="tagID"></div> <div class="popup-footer"><button id="addNOLFormSubmit" type="submit" class="button" name="submit" value="submit">'+ulang.GLOBAL.BUTNS.SAVE+"</button></div> </form></div>",document.getElementById("addNOLForm").addEventListener("submit",function(a){a.preventDefault();var b=!0;document.getElementById("tagID").className="",10!=document.getElementById("tagID").value.trim().length&&(document.getElementById("tagID").className="required",b=!1),b&&saveNewCard("NOL")})},addSalikAccount.onclick=function(){popup.open(),info.innerHTML='<div class="popup"><div class="popup-header"><span class="popup-title">'+pageTexts.AddSalikCardFormTitle+'</span><span class="popup-close" onclick="popup.close();"></span></div><form id="addSalikForm"><div class="popup-content"><label>'+pageTexts.AddSalikCardInputlabel+'</label><input type="tel" maxlength="8" id="accountID" name="accountID"><label>'+pageTexts.AddSalikCardPinlabel+'</label><input type="tel" maxlength="4" id="accountPIN" name="accountPIN"></div> <div class="popup-footer"><button id="addSalikFormSubmit" type="submit" class="button" name="submit" value="submit">'+ulang.GLOBAL.BUTNS.SAVE+"</button></div> </form></div>",document.getElementById("addSalikForm").addEventListener("submit",function(a){a.preventDefault();var b=!0;document.getElementById("accountID").className="",8!=document.getElementById("accountID").value.trim().length&&(document.getElementById("accountID").className="required",b=!1),document.getElementById("accountPIN").className="",4!=document.getElementById("accountPIN").value.trim().length&&(document.getElementById("accountPIN").className="required",b=!1),b&&SalikCard.saveCard()})},salikCardLists.innerHTML="<div class='initialBookingLoader bookingLoader'>",nolCardLists.innerHTML="<div class='initialBookingLoader bookingLoader'>",document.getElementById("salikTopUpButtonButton").addEventListener("click",function(a){popup.open(),info.innerHTML='<div class="popup"><div class="popup-header"><span class="popup-title">'+pageTexts.SalikTopUpFormTitle+'</span><span class="popup-close" onclick="popup.close();"></span></div><form id="SalikTopUpForm"><div class="popup-content"><label>'+pageTexts.AddSalikCardInputlabel+'</label><input type="tel" id="salikTopUpAccountID" maxlength="8"><label>'+pageTexts.AddSalikCardPinlabel+'</label><input type="tel" id="salikTopUpAccountPIN" maxlength="4"><label>'+pageTexts.SalikVoucherCode+'</label><input type="tel" id="salikTopUpVoucher" maxlength="12"></div> <div class="popup-footer"><button type="submit" class="button" name="submit" value="submit">'+pageTexts.SalikTopUpSubmit+"</button></div> </form></div>",document.getElementById("salikTopUpAccountID").value=salikCardLists.childNodes[0].id.split("/")[0],document.getElementById("SalikTopUpForm").addEventListener("submit",function(a){a.preventDefault();var b=!0;if(document.getElementById("salikTopUpAccountID").className="",8!=document.getElementById("salikTopUpAccountID").value.trim().length&&(document.getElementById("salikTopUpAccountID").className="required",b=!1),document.getElementById("salikTopUpAccountPIN").className="",4!=document.getElementById("salikTopUpAccountPIN").value.trim().length&&(document.getElementById("salikTopUpAccountPIN").className="required",b=!1),document.getElementById("salikTopUpVoucher").className="",12!=document.getElementById("salikTopUpVoucher").value.trim().length&&(document.getElementById("salikTopUpVoucher").className="required",b=!1),b){var c="R*"+document.getElementById("salikTopUpVoucher").value.trim()+"*"+document.getElementById("salikTopUpAccountID").value.trim()+"*"+document.getElementById("salikTopUpAccountPIN").value.trim();popup.close(),location.href="shailapp://balance/salik/topup?code="+c}})}),loadJSON("GET",endPoint+"/thirdparty/rtaid/user?userData="+userData,function(a){var b=null,c=null;getCloudData({dataSafeKey:"NOLCardSelected",success:function(a){"undefined"!=typeof a.dataSafeValue&&(b=JSON.parse(a.dataSafeValue)),getCloudData({dataSafeKey:"NOLCloudLists",success:function(a){var c=null,d=[];"undefined"!=typeof a.dataSafeValue&&(c=JSON.parse(a.dataSafeValue),d=c.nolLists),d.length>0?d.forEach(function(a){var c=a.tagID,d={language:"en-US",userID:"user",tagID:c};debug&&(d.debug=!0),postJSON({url:endPointBooking+"/nol/cardKey?_rnd="+(new Date).getTime(),postBody:JSON.stringify(d),success:function(d){var e={language:"en-US",userID:"user",cardKey:d.cardKey};debug&&(e.debug=!0),postJSON({url:endPointBooking+"/nol/balance?_rnd="+(new Date).getTime(),postBody:JSON.stringify(e),success:function(d){if(null!=b&&a.tagID==b.tagID)var e=!0;else var e=!1;addNOLHtmlItem({balance:d.balance,Id:c,selectedDefault:e})},error:function(){}})},error:function(){}})}):nolCardLists.innerHTML="<div class='noBookingsMessage'>"+pageTexts.NoNolCard+"</div>"}})}}),getCloudData({dataSafeKey:"SalikCardSelected",success:function(a){"undefined"!=typeof a.dataSafeValue&&(c=JSON.parse(a.dataSafeValue)),getCloudData({dataSafeKey:"SalikCloudLists",success:function(a){var b=null,d=[];"undefined"!=typeof a.dataSafeValue&&(b=JSON.parse(a.dataSafeValue),d=b.salikLists),d.length>0?d.forEach(function(a){var b={accountID:a.accountID,accountPIN:a.accountPIN};debug&&(b.debug=!0),postJSON({url:endPointBooking+"/salik/balance?_rnd="+(new Date).getTime(),postBody:JSON.stringify(b),success:function(a){salikCardLists.innerHTML="",document.getElementById("addSalikAccount").style.display="none",document.getElementById("salikTopUpButton").style.display="";var d=b.accountID+"/"+b.accountPIN;if(null!=c&&d==c.accountID)var e=!0;else var e=!1;SalikCard.renderCard({balance:a.balance,accountID:b.accountID,accountPIN:b.accountPIN,selectedDefault:e})},error:function(){salikCardLists.innerHTML="<div class='noBookingsMessage'>"+pageTexts.ADDCARD_ERROR+"</div>",document.getElementById("addSalikAccount").style.display="none",document.getElementById("salikTopUpButton").style.display="none"}})}):(salikCardLists.innerHTML="<div class='noBookingsMessage'>"+pageTexts.NoSalikAccount+"</div>",document.getElementById("addSalikAccount").style.display="",document.getElementById("salikTopUpButton").style.display="none")}})},error:function(){}})});